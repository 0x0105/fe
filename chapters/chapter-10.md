前端的难点：模型维护与数据存储
===

> 前端

最近，在用强类型语言的 TypeScript 编写一个前端的库，重新让我发现了强类型语言在建模方面的优势。

前端从后台拿到数据后，这些数据对于后台来说，就是一个模型。对于后台来说，这就是将单个的 Model 或者 Model 相关的集合放到一起，再用某个方法将他们转向 JSON，如 Spring 里的 ，又或者是 Django 里的。。

多模型
---

正常的情况下，前端拿到这些数据，稍微做一些处理就可以显示到页面上。在一些复杂的例子里，我们需要做一些特殊的处理，如当我们从后台拿到了两种不同类型的产品，但是他们继承了同一个类，而返回了两种不同的结果。而在前台出于业务的需要，我们又需要将这些模型转为统一的形式，如不同的用户形式。

对于 A（普通的用户） 来说，用户名就是它的手机号，而 Full Name 才是它的真实名字。

对于 B （管理员）来说，公司相关的邮箱才是它的用户名，mobile 才是它的手机号，Full Name 也是真实名字。

虽然对于 A 来说，还可能存在。。尽管对于后台来说，他们可以转换这些模型，但是当我们创建用户的时候，就会变成一个问题。

我们不能用同一个模型来创建这些数据 。


继承自同一模型的两个不同的模型，可能会两个不同的名字。普通的用户和管理员就是一个很好的例子，这个时候，你会怎么去解决这个问题？


最近，我在写一个名为 EventStorming.Graph 的图形工具。设计的过程中，尽量采用了 DDD 中的一些思想，于是用观察者模式，作为消息的中心来懊 事件。

在这领域里，有一个基本的内容就是事件。当用户创建了一个事件的时候，会发现这么一些事情。在 EventBusiness 中创建了 Observable，并让监听相应的 Observer 监听。有两个基本的观察者：

 - 存储。当用户创建了一个事件的时候，就会从 EB 中获取到相应的对应，直接存储到数据库中。
 - 渲染。当用户创建了一个事件的时候，我需要把事件以 Sticky（便利贴）的形式渲染到页面上。这个时候，我需要为事件对象添加一些额外的属性，如色彩、位置等等，这个时候，它已经不是一个事件模型，而是一个事件便利贴。

也因此，我为它创建了一个新的 ID，用来区分旧的便利贴，并且还保留着旧的事件 ID，以便于未来更新对象。

随后，这些数据会被存储到存储介质中。

存储
---

由于不同的原因，我们会存储不同的内容：

 - 在页面间共享数据——适用于同一个网站，页面间使用不同的框架
 - 存储用户的 token
 - 缓存在数据库中，加快下次打开速度
 - 临时保存用户存储的表单

数据存储并不是一件很难的事。我们只需要想一个 key，再想一个 value 就可以保存这个值了，如 localStorge 的setItem 和 getItem 就可以轻松达到这个要求了。而对于常用的数据格式来说，加上个 ``JSON.stringify`` 来转换对象为字符 串，从 localStorage 中读取数据时，再用 ``JSON.parse`` 去解析即可。 

或者的情况下，我们可需要在不同的存储介质中保持他们了，这个时候只需要不同的适配器即可。

我们可以使用不同的库来，如支持使用不同介质的 localForge，IndexedDB、WebSQL、localStorage ，又或者是支持不同浏览器的 store.js

问题的另外一个难点在于存储什么，怎么存储。













